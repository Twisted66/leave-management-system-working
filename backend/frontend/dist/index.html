<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leave Management System</title>
    <script>
      // Production MIME type workaround for Encore deployment
      if (window.location.hostname.includes('encr.app')) {
        console.log('Production mode: Loading assets dynamically to bypass MIME issues');
        
        // Function to dynamically load script with proper MIME handling
        function loadScript(src, isModule = false) {
          return new Promise((resolve, reject) => {
            fetch(src)
              .then(response => {
                if (!response.ok) throw new Error(`Failed to fetch ${src}: ${response.status}`);
                return response.text();
              })
              .then(scriptText => {
                const script = document.createElement('script');
                if (isModule) script.type = 'module';
                script.textContent = scriptText;
                document.head.appendChild(script);
                console.log(`Loaded script: ${src}`);
                resolve();
              })
              .catch(err => {
                console.error('Failed to load script:', src, err);
                reject(err);
              });
          });
        }
        
        // Function to dynamically load CSS
        function loadCSS(href) {
          return new Promise((resolve, reject) => {
            fetch(href)
              .then(response => {
                if (!response.ok) throw new Error(`Failed to fetch ${href}: ${response.status}`);
                return response.text();
              })
              .then(cssText => {
                const style = document.createElement('style');
                style.textContent = cssText;
                document.head.appendChild(style);
                console.log(`Loaded CSS: ${href}`);
                resolve();
              })
              .catch(err => {
                console.error('Failed to load CSS:', href, err);
                reject(err);
              });
          });
        }
        
        // Load assets when DOM is ready
        document.addEventListener('DOMContentLoaded', async function() {
          try {
            // Remove static tags first to prevent conflicts
            const scripts = document.querySelectorAll('script[src*="/assets/"]');
            scripts.forEach(script => script.remove());
            const links = document.querySelectorAll('link[href*="/assets/"]');
            links.forEach(link => link.remove());
            
            console.log('Loading application assets...');
            
            // Get the actual asset filenames from the generated script/link tags
            const assetElements = {
              css: [],
              js: []
            };
            
            // Find all asset references in the HTML
            document.querySelectorAll('script[src*="/assets/"]').forEach(script => {
              const filename = script.src.split('/').pop();
              if (filename) assetElements.js.push(filename);
            });
            
            document.querySelectorAll('link[href*="/assets/"]').forEach(link => {
              const filename = link.href.split('/').pop();
              if (filename && link.rel === 'stylesheet') assetElements.css.push(filename);
            });
            
            // Load CSS assets
            for (const filename of assetElements.css) {
              await loadCSS(`/frontend/assets/${filename}`);
            }
            
            // Load JS assets (dependencies first, then main)
            const jsFiles = assetElements.js.sort((a, b) => {
              if (a.includes('vendor')) return -1;
              if (b.includes('vendor')) return 1;
              if (a.includes('utils')) return -1;
              if (b.includes('utils')) return 1;
              if (a.includes('supabase')) return -1;
              if (b.includes('supabase')) return 1;
              return 0;
            });
            
            for (const filename of jsFiles) {
              await loadScript(`/frontend/assets/${filename}`, true);
            }
            
            console.log('All assets loaded successfully!');
          } catch (error) {
            console.error('Failed to load application assets:', error);
            // Show error message with refresh button
            document.body.innerHTML = `
              <div style="padding: 40px; color: #dc3545; font-family: Arial, sans-serif; text-align: center;">
                <h2>Application Loading Error</h2>
                <p>Failed to load application assets: ${error.message}</p>
                <button onclick="location.reload()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                  Refresh Page
                </button>
              </div>
            `;
          }
        });
      }
    </script>
    <script type="module" crossorigin src="/frontend/assets/index-N-ZpjYWE.js"></script>
    <link rel="modulepreload" crossorigin href="/frontend/assets/supabase-De4MVlsz.js">
    <link rel="modulepreload" crossorigin href="/frontend/assets/utils-DWHcN4y_.js">
    <link rel="modulepreload" crossorigin href="/frontend/assets/vendor-Hu-ULBDt.js">
    <link rel="stylesheet" crossorigin href="/frontend/assets/index-DcdqvTDb.css">
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
